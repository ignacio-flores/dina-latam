{smcl}
{res}{sf}{ul off}{txt}{.-}
      name:  {res}<unnamed>
       {txt}log:  {res}E:\Users\i.flores.PSE\Documents\GitHub\dina-latam\output/ineqstats/log/ ind_natinc_4Sep2025.smcl
  {txt}log type:  {res}smcl
 {txt}opened on:  {res} 4 Sep 2025, 18:33:36
step: natinc
- ind_nat_norm-
{err}option {bf}decomposition(){sf} required
{txt}{search r(198), local:r(198);}

end of do-file

{search r(198), local:r(198);}

{com}. do "E:\Users\i.flores.PSE\Documents\GitHub\dina-latam\code\Stata\06a-run-ineqstats.do"
{txt}
{com}. ////////////////////////////////////////////////////////////////////////////////
> //
. //                                              Title: INEQUALITY STATISTICS - DATA 
. //                       Authors: Mauricio DE ROSA, Ignacio FLORES, Marc MORGAN 
. //                                                                      Year: 2020
. //
. //                      Description:
. //                      Apply the 'ineqstats' program to various steps of our correction
. //                      and save results for analysis. It provides income shares, ginis, 
. //                      , theil, sginis and income composition for every country-year 
. //
. ///////////////////////////////////////////////////////////////////////////////
> 
. clear all 
{res}{txt}
{com}. 
. //General settings -------------------------------------------------------------
. 
. //get list of paths 
. global aux_part " "preliminary" " 
{txt}
{com}. qui do "code/Stata/auxiliar/aux_general.do"
{txt}
{com}. 
. //find program
. sysdir set PERSONAL "code/Stata/ado/ineqstats_ado/." 
{txt}
{com}. 
. //Run ineqstats program --------------------------------------------------------
. 
. foreach step in $all_steps {c -(}
{txt}  2{com}. 
.         local date "$S_DATE"
{txt}  3{com}.         local date = subinstr("`date'", " ", "", .)
{txt}  4{com}.         
.         //get short name of step
.         local s = substr("`step'", 1, 3)
{txt}  5{com}.         
.         //normie locals
.         local type "`step'"
{txt}  6{com}.         local weight "_weight"
{txt}  7{com}.         local bfm "" 
{txt}  8{com}.         
.         //special-cases
.         if inlist("`step'", "raw", "por") local weight "_fep"
{txt}  9{com}.         if ("`step'" == "raw") local ext "_svy_y" 
{txt} 10{com}.         else local ext ""
{txt} 11{com}.         if inlist("`step'", "bfm${c -(}ext{c )-}_pre") local bfm_`step' "bfm"
{txt} 12{com}.         if inlist("`step'", "rescaled", "uprofits", ///
>                 "natinc", "pod", "pon", "psp") {c -(}
{txt} 13{com}.                 local type "bfm${c -(}ext{c )-}_pre"
{txt} 14{com}.         {c )-}
{txt} 15{com}.         
.         //create main folders 
.         local dirpath "output/ineqstats"
{txt} 16{com}.         mata: st_numscalar("exists", direxists(st_local("dirpath")))
{txt} 17{com}.         if (scalar(exists) == 0) {c -(}
{txt} 18{com}.                 mkdir "`dirpath'"
{txt} 19{com}.                 display "Created directory: `dirpath'"
{txt} 20{com}.         {c )-}
{txt} 21{com}.         //create main folders 
.         local dirpath "output/ineqstats/log"
{txt} 22{com}.         mata: st_numscalar("exists", direxists(st_local("dirpath")))
{txt} 23{com}.         if (scalar(exists) == 0) {c -(}
{txt} 24{com}.                 mkdir "`dirpath'"
{txt} 25{com}.                 display "Created directory: `dirpath'"
{txt} 26{com}.         {c )-}
{txt} 27{com}.         
.         //statistical units
.         global units "$units_06a"
{txt} 28{com}.         foreach unit in "${c -(}units{c )-}" {c -(}
{txt} 29{com}. 
.                 cap log close
{txt} 30{com}.                 log using "output/ineqstats/log/`unit'_`step'_`date'.smcl", replace 
{txt} 31{com}.                 if inlist("`unit'", "ind", "esn") local age 20
{txt} 32{com}.                 if inlist("`unit'", "pch") local age 0
{txt} 33{com}.                 if inlist("`unit'", "act") local age 20 65
{txt} 34{com}.                 
.                 //loop over country groups      
.                 di as result "step: `step'"
{txt} 35{com}.                 
.                 di as result "-`unit'_`s'_norm-"
{txt} 36{com}.                 
.                 //call program  
.                  ineqstats summarize, `bfm_`step'' ///
>                         svypath("intermediary_data/microdata/bfm${c -(}ext{c )-}_pre") edad(`age') ///
>                         type(`type') time($first_y $last_y) area(${c -(}all_countries{c )-}) ///
>                         export("output/ineqstats/ineqstats_`step'_`unit'.xlsx") ///
>                         weight(`weight') dec(${c -(}`unit'_`s'_norm{c )-}) ///
>                         unit(`unit')  /*smoothtop*/
{txt} 37{com}.                 log close 
{txt} 38{com}.         {c )-}
{txt} 39{com}. {c )-}       
{res}{smcl}
{res}{sf}{ul off}